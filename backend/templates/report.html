<!DOCTYPE html>
<html lang="en">
<head>
    <title>Smart Diabetes Monitoring Medical Report</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%);
            margin: 0;
            padding: 20px;
            color: #333;
            position: relative;
            overflow-x: hidden;
        }

        /* Subtle background pattern for uniqueness */
        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: radial-gradient(circle, rgba(186, 104, 200, 0.1) 1px, transparent 1px);
            background-size: 50px 50px;
            opacity: 0.3;
            z-index: -1;
        }

        /* 3D Sticker-like Elements */
        .sticker {
            position: absolute;
            font-size: 2rem;
            color: rgba(106, 27, 154, 0.2);
            animation: float 6s ease-in-out infinite;
            z-index: -1;
        }

        .sticker:nth-child(1) {
            top: 10%;
            left: 10%;
            animation-delay: 0s;
            transform: rotateY(15deg) rotateX(10deg);
        }

        .sticker:nth-child(2) {
            top: 20%;
            right: 15%;
            animation-delay: 2s;
            transform: rotateY(-15deg) rotateX(-10deg);
        }

        .sticker:nth-child(3) {
            bottom: 15%;
            left: 20%;
            animation-delay: 4s;
            transform: rotateY(20deg) rotateX(-5deg);
        }

        .sticker:nth-child(4) {
            bottom: 25%;
            right: 10%;
            animation-delay: 1s;
            transform: rotateY(-20deg) rotateX(15deg);
        }

        .sticker:nth-child(5) {
            top: 50%;
            left: 5%;
            animation-delay: 3s;
            transform: rotateY(10deg) rotateX(-10deg);
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotateY(0deg) rotateX(0deg); }
            50% { transform: translateY(-20px) rotateY(10deg) rotateX(5deg); }
        }

        .page {
            width: 210mm;
            min-height: 297mm;
            margin: auto;
            background: white;
            padding: 30px 40px;
            box-shadow: 0 10px 30px rgba(106, 27, 154, 0.2);
            border-radius: 10px;
            position: relative;
            z-index: 1;
        }

        .page::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, #6a1b9a, #ba68c8);
            border-radius: 10px 10px 0 0;
        }

        .header {
            text-align: center;
            border-bottom: 3px solid #6a1b9a;
            padding-bottom: 15px;
            margin-bottom: 25px;
            position: relative;
        }

        .header h1 {
            color: #6a1b9a;
            margin: 0;
            font-size: 28px;
            font-weight: 700;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }

        .header::after {
            content: '\f21e';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            color: #6a1b9a;
            font-size: 24px;
            position: absolute;
            right: 10px;
            top: 10px;
        }

        .subhead {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            margin-top: 10px;
            color: #555;
        }

        .section {
            margin-top: 20px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(106, 27, 154, 0.1);
        }

        .section h3 {
            background: linear-gradient(90deg, #6a1b9a, #ba68c8);
            color: white;
            padding: 10px 15px;
            font-size: 16px;
            margin: 0;
            display: flex;
            align-items: center;
        }

        .section h3 i {
            margin-right: 10px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
            margin-top: 10px;
        }

        th, td {
            border: 1px solid #e0e0e0;
            padding: 12px;
            text-align: left;
        }

        th {
            background: linear-gradient(90deg, #f3e5f5, #e1bee7);
            color: #6a1b9a;
            font-weight: 600;
        }

        tr:nth-child(even) {
            background: #f9f9f9;
        }

        tr:hover {
            background: #f0f8ff;
        }

        .remarks-box {
            height: 80px;
            border: 1px solid #e0e0e0;
            padding: 10px;
            background: #fafafa;
            border-radius: 5px;
            font-style: italic;
        }

        .recommendations ul {
            list-style: none;
            padding: 0;
        }

        .recommendations li {
            padding: 8px 0;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            align-items: center;
        }

        .recommendations li i {
            margin-right: 10px;
            color: #6a1b9a;
        }

        .signature {
            margin-top: 50px;
            text-align: right;
            font-size: 16px;
            color: #6a1b9a;
            border-top: 2px solid #6a1b9a;
            padding-top: 20px;
        }

        @media print {
            body {
                background: white;
            }
            .page {
                box-shadow: none;
                border-radius: 0;
            }
            .sticker {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .page {
                width: 100%;
                padding: 20px;
            }
            .subhead {
                flex-direction: column;
                align-items: center;
            }
            .subhead div {
                margin-bottom: 5px;
            }
            .sticker {
                font-size: 1.5rem;
            }
        }
    </style>
</head>

<body>
    <!-- 3D Sticker Elements -->
    <div class="sticker"><i class="fas fa-heartbeat"></i></div>
    <div class="sticker"><i class="fas fa-syringe"></i></div>
    <div class="sticker"><i class="fas fa-chart-line"></i></div>
    <div class="sticker"><i class="fas fa-pills"></i></div>
    <div class="sticker"><i class="fas fa-stethoscope"></i></div>

<div class="page">

    <div class="header">
        <h1>SMART DIABETES MONITORING – MEDICAL REPORT</h1>
        <div class="subhead">
            <div><strong>Report ID:</strong><span>{{ report_id }}</span>

 </div>
            <div><strong>Date & Time:</strong><span>{{ now }}</span> </div>
        </div>
    </div>

    <!-- Patient Info -->
    <div class="section">
        <h3><i class="fas fa-user"></i>Patient Information</h3>
        <table>
            <tr>
    <th>Patient Name</th>
    <td>{{ user.name }}</td>

    <th>Age</th>
    <td>{{ user.age }}</td>
</tr>

<tr>
    <th>Gender</th>
    <td>{{ user.gender if user.gender else "N/A" }}</td>

    <th>Contact No.</th>
    <td>{{ user.contact if user.contact else "N/A" }}</td>
</tr>

<tr>
    <th>Height (cm)</th>
    <td>{{ user.height }}</td>

    <th>Weight (kg)</th>
    <td>{{ user.weight }}</td>
</tr>

<tr>
    <th>BMI (kg/m²)</th>
    <td colspan="3">{{ user.bmi }}</td>
</tr>

        </table>
    </div>

    <!-- Vitals -->
    <div class="section">
        <h3><i class="fas fa-heartbeat"></i>Vital & Sensor Readings</h3>
        <table>
            <tr>
                <th>Parameter</th>
                <th>Value</th>
                <th>Normal Range</th>
                <th>Remarks</th>
            </tr>
            <tr>
    <td>Glucose Level (mg/dL)</td>
    <td>{{ p.glucose }}</td>
    <td>70–140</td>
    <td>
        {% if p.glucose < 70 %}
            Low
        {% elif p.glucose > 140 %}
            High
        {% else %}
            Normal
        {% endif %}
    </td>
</tr>

<tr>
    <td>Heart Rate (bpm)</td>
    <td>{{ p.heart_rate }}</td>
    <td>60–100</td>
    <td>
        {% if p.heart_rate < 60 %}
            Low
        {% elif p.heart_rate > 100 %}
            High
        {% else %}
            Normal
        {% endif %}
    </td>
</tr>

<tr>
    <td>Activity (steps/day)</td>
    <td>{{ p.activity }}</td>
    <td>6000–10000</td>
    <td>
        {% if p.activity < 6000 %}
            Low
        {% else %}
            Normal
        {% endif %}
    </td>
</tr>

        </table>
    </div>

    <!-- Risk -->
    <div class="section">
        <h3><i class="fas fa-chart-line"></i>Risk Analysis (ML Prediction)</h3>
        <table>
            <tr>
    <th>Risk Probability</th>
    <td>{{ (p.probability * 100) | round(2) }}%</td>
</tr>
<tr>
    <th>Status</th>
    <td>
        {% if p.probability > 0.7 %}
            High Risk
        {% elif p.probability > 0.4 %}
            Medium Risk
        {% else %}
            Low Risk
        {% endif %}
    </td>
</tr>

        </table>
    </div>

    <div class="section">
        <h3><i class="fas fa-comment-medical"></i>Doctor / System Remarks</h3>
        <div class="remarks-box"></div>
    </div>

    <div class="signature">
        <strong>Authorized Signature</strong>
    </div>

</div>

<script>
    // Auto Date & Time
    const now = new Date();
    document.getElementById("dateTime").innerText = now.toLocaleString();
    document.getElementById("reportId").innerText = "RPT-" + now.getTime();

    // ===== Patient + Sensor Data (replace from ESP32 / form) =====
   

    // ===== BMI =====
    let bmi = (patient.weight / ((patient.height/100) ** 2)).toFixed(2);

    // ===== Remarks Function =====
    function remark(value, min, max){
        if(value < min) return "Low";
        if(value > max) return "High";
        return "Normal";
    }

    // ===== Risk Logic =====
    let risk = "Low";
    if(patient.glucose > 140 || bmi > 25 || patient.activity < 5000){
        risk = "High";
    }

    let status = (risk === "High") ? "Pre-Diabetic" : "Normal";

    // ===== Recommendation Logic =====
    let recommendations = [];

    if(patient.glucose > 140){
        recommendations.push("⚠ High glucose detected – avoid sugar & take light walk for 15 minutes.");
    }
    if(patient.hr > 100){
        recommendations.push("⚠ High heart rate – rest and stay calm.");
    }
    if(patient.activity < 6000){
        recommendations.push("⚠ Low activity – increase daily walking steps.");
    }
    if(bmi > 25){
        recommendations.push("⚠ BMI is high – follow weight control diet plan.");
    }
    if(risk === "Low"){
        recommendations.push("✅ All readings normal – maintain your healthy routine.");
    }

    // ===== Fill Data =====
    document.getElementById("name").innerText = patient.name;
    document.getElementById("age").innerText = patient.age;
    document.getElementById("gender").innerText = patient.gender;
    document.getElementById("contact").innerText = patient.contact;
    document.getElementById("height").innerText = patient.height;
    document.getElementById("weight").innerText = patient.weight;
    document.getElementById("bmi").innerText = bmi;

    document.getElementById("glucose").innerText = patient.glucose;
    document.getElementById("hr").innerText = patient.hr;
    document.getElementById("activity").innerText = patient.activity;

    document.getElementById("gRemark").innerText = remark(patient.glucose,70,140);
    document.getElementById("hRemark").innerText = remark(patient.hr,60,100);
    document.getElementById("aRemark").innerText = remark(patient.activity,6000,10000);

    document.getElementById("risk").innerText = risk;
    document.getElementById("status").innerText = status;

    // ===== Show Recommendations in Report =====
    let recList = "<div class='recommendations'><ul>";
    recommendations.forEach(r => {
        let icon = r.includes("⚠") ? "<i class='fas fa-exclamation-triangle'></i>" : "<i class='fas fa-check-circle'></i>";
        recList += "<li>" + icon + r.replace(/^[⚠✅]\s*/, "") + "</li>";
    });
    recList += "</ul></div>";

    // Create section if not present
    let recSection = document.createElement("div");
    recSection.className = "section";
    recSection.innerHTML = `
        <h3><i class="fas fa-lightbulb"></i>Real-Time System Recommendations</h3>
        ${recList}
    `;
    document.querySelector(".signature").before(recSection);

</script>

</body>
</html>